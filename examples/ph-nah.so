load "system";

# Process in the development of Nahuatl where /t/ -> [tɬ] at the beginning of a syllable followed by a nucleus /aː/
# This rule is not universal (c.f. /is.ta+tɬ/ -> [is.tatɬ] "salt", /tat+tɬ/ -> [taʔ.tɬi] "father")
var r1 = S : 't' -> {'t_ɬ'} // {"$"} ~ {[-high, +low, -front, -back, -tense]};
# Because the language is strictly (C)V(C), a consonant clustur is broken up by /i/
var r2 = S : 't_ɬ' -> {'t_ɬ', 'i'} // {[-syl, +cons], "$"} ~ {};
# Assimilation of /tɬ/ to just [l] when suffixed to a root ending in /l/
# This only occurs at morpheme boundaries, [ll] does not naturally occur in roots
var r3 = S : 't_ɬ' -> {'l'} // {'l', "+"} ~ {};

var w1 = `taː.wiːl+t_ɬ`;
var w2 = `te.oː.kʷi.ta+t_ɬ`;

print(w1 >> r1 >> r2 >> r3);
print(w2 >> r1 >> r2 >> r3);